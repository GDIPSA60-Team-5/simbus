name: Build

on:
  workflow_call:
    inputs:
      folder:
        required: true
        type: string

jobs:
  validate:
    runs-on: ubuntu-latest
    outputs:
      folder: ${{ steps.validate.outputs.folder }}
    steps:
      - name: âœ… Validate Folder
        id: validate
        run: |
          case "${{ inputs.folder }}" in
            next-frontend|spring-backend|android-kotlin|llm-backend)
              echo "folder=${{ inputs.folder }}" >> "$GITHUB_OUTPUT"
              ;;
            *)
              echo "Invalid folder: ${{ inputs.folder }}"
              exit 1
              ;;
          esac

  next-frontend:
    if: needs.validate.outputs.folder == 'next-frontend'
    needs: validate
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: ğŸ“¦ Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 20
          cache: npm

      - name: ğŸ”§ Build Next.js App
        run: |
          cd next-frontend
          npm ci
          npm run build

  spring-backend:
    if: needs.validate.outputs.folder == 'spring-backend'
    needs: validate
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: â˜• Setup Java
        uses: actions/setup-java@v3
        with:
          distribution: temurin
          java-version: 17
          cache: maven

      - name: ğŸ”§ Build Spring Backend
        run: |
          cd spring-backend
          chmod +x mvnw
          ./mvnw clean verify -DskipTests

  android-kotlin:
    if: needs.validate.outputs.folder == 'android-kotlin'
    needs: validate
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: â˜• Setup Java
        uses: actions/setup-java@v3
        with:
          distribution: temurin
          java-version: 17
          cache: gradle

      - name: ğŸ”§ Build Android App
        run: |
          cd android-kotlin
          chmod +x gradlew
          ./gradlew assembleRelease

  llm-backend:
    if: needs.validate.outputs.folder == 'llm-backend'
    needs: validate
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: ğŸ Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: 3.x
          cache: pip

      - name: ğŸ”§ Install Dependencies & Build
        run: |
          cd llm-backend
          pip install -r requirements.txt
          # Add any build step if required
